//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "EditAutopart.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm14 *Form14;
//---------------------------------------------------------------------------
__fastcall TForm14::TForm14(TComponent* Owner)
	: TForm(Owner)
{
	LoadAutoparts();
}
//---------------------------------------------------------------------------
void TForm14::LoadAutoparts() {
    ListBoxWorkers->Clear();
	ADOQuery->SQL->Text = "SELECT * FROM Автозапчасти";
	ADOQuery->Open();
    while (!ADOQuery->Eof) {
		ListBoxWorkers->Items->Add(ADOQuery->FieldByName("Название")->AsString);
        ADOQuery->Next();
    }
    ADOQuery->Close();
}


void __fastcall TForm14::ListBoxWorkersClick(TObject *Sender) {
    if (ListBoxWorkers->ItemIndex != -1) {
		ADOQuery->SQL->Text = "SELECT * FROM Автозапчасти WHERE Название = :Name";
        ADOQuery->Parameters->ParamByName("Name")->Value = ListBoxWorkers->Items->Strings[ListBoxWorkers->ItemIndex];
        ADOQuery->Open();
		EditName->Text = ADOQuery->FieldByName("Товар")->AsString;
        ADOQuery->Close();
    }
}

//
void __fastcall TForm14::ButtonAddClick(TObject *Sender)
{
    if (ListBoxWorkers->ItemIndex != -1) {
		try {
			ADOQuery->SQL->Text = "UPDATE Автозапчасти SET Название = :Name, Цена = :Price, Количество = :Count WHERE Название = :OldName";
			ADOQuery->Parameters->ParamByName("Name")->Value = EditName->Text;
			ADOQuery->Parameters->ParamByName("Price")->Value = EditName->Text;
			ADOQuery->Parameters->ParamByName("Count")->Value = EditName->Text;
            ADOQuery->Parameters->ParamByName("OldName")->Value = ListBoxWorkers->Items->Strings[ListBoxWorkers->ItemIndex];


			ADOQuery->ExecSQL();
            LoadAutoparts();

            MessageDlg("Запись успешно обновлена!", mtInformation, TMsgDlgButtons() << mbOK, 0);
        }
		catch (Exception &E) {
            MessageDlg("Ошибка при обновлении записи: " + E.Message, mtError, TMsgDlgButtons() << mbOK, 0);
        }
	}
}
